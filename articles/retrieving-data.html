<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieving data from VectorByte • ohvbd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieving data from VectorByte">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ohvbd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/retrieving-data.html">Retrieving data from VectorByte</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fwimp/ohvbd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Retrieving data from VectorByte</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fwimp/ohvbd/blob/master/vignettes/retrieving-data.Rmd" class="external-link"><code>vignettes/retrieving-data.Rmd</code></a></small>
      <div class="d-none name"><code>retrieving-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The ohvbd package allows you to retrieve data from many different
databases directly.</p>
<p>Currently these databases include the <a href="https://vectorbyte.crc.nd.edu/vectraits-explorer" class="external-link">VecTraits</a>
and <a href="https://vectorbyte.crc.nd.edu/vecdyn-datasets" class="external-link">VecDyn</a>
projects from <a href="https://www.vectorbyte.org/" class="external-link">VectorByte</a>.</p>
<p>Let’s imagine you wanted to figure out where a particular vector
species - <em>Aedes aegypti</em>, for example - was found. Here’s how
you’d use <code>ohvbd</code> to do that:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_vt.html">search_vt</a></span><span class="op">(</span><span class="st">"Aedes aegypti"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/get_vt_byid.html">get_vt_byid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/extract_vt_data.html">extract_vt_data</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Interactor1Genus"</span>, <span class="st">"Interactor1Species"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span><span class="op">)</span>,</span>
<span>    returnunique <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<p>Great, lovely. But now… what does that all mean? And how can you
build up your own data request? Read on to find out…</p>
</div>
<div class="section level2">
<h2 id="some-notes-before-we-begin">Some notes before we begin<a class="anchor" aria-label="anchor" href="#some-notes-before-we-begin"></a>
</h2>
<p>If you are using Linux, sometimes <code>httr2</code> fails to
communicate with the VectorByte servers. As such on these systems it is
best to set ohvbd to use slightly less stringent identity checks in its
calls to the server.</p>
<p>You only need to perform this once per R session / script.</p>
<!-- Shim to make sure vignette builds on ubuntu-->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_ohvbd_compat.html">set_ohvbd_compat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For users who are familiar with tidyverse pipes
(<code>%&gt;%</code>), this approach is generally usable in ohvbd as
well.</p>
<p>For users who are not familiar, pipes take the output of one command
and feed it forward to the next command as the first argument:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find mean of a vector normally</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find mean of a vector using pipes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<p>For the rest of this vignette we will be using a piped-style
approach.</p>
<p>Another note before we begin: the functions used to interface with
VecTraits and VecDyn are basically the same, except for a
<code>vt</code> or <code>vd</code> in the function name. So
<code><a href="../reference/search_vt.html">search_vt()</a></code> is the VecTraits equivalent of
<code><a href="../reference/search_vd.html">search_vd()</a></code>. We will use VecTraits functions in this
vignette, but the process is the same for VecDyn.</p>
</div>
<div class="section level2">
<h2 id="finding-ids">Finding IDs<a class="anchor" aria-label="anchor" href="#finding-ids"></a>
</h2>
<p>Datasets in VecTraits and VecDyn are organised by id. As such it is
often good to be able to see which IDs are currently available. We can
do this using the <code>get_current_x_ids()</code> family of functions.
These return a vector of valid IDs on the given database:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fwimp/ohvbd" class="external-link">ohvbd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_current_vt_ids.html">get_current_vt_ids</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</span></span></code></pre>
<p>The functions <code>search_x()</code> and
<code>search_x_smart()</code> also return a list of IDs that match the
query provided in the arguments.</p>
<p>In this case let’s search VecTraits for <em>Aedes aegypti</em>, the
“Yellow Fever mosquito”:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aedes_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_vt.html">search_vt</a></span><span class="op">(</span><span class="st">"Aedes aegypti"</span><span class="op">)</span></span>
<span><span class="va">aedes_ids</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  97  98 124 125 126 142 143 144 145 146 147 148 149 169 170 214 285 286 287</span></span>
<span><span class="co">## [20] 346 354 355 356 357 358 359 473 474 475 476 552 553 554 555 556 557 558 564</span></span>
<span><span class="co">## [39] 565 571 572 573 574 575 576 577 578 579 580</span></span></code></pre>
<p>This again returns a vector of IDs, this time corresponding to any
dataset with <em>Aedes aegypti</em> in one of the searchable
columns.</p>
<p>You can also find IDs interactively online by using the <a href="https://vectorbyte.crc.nd.edu/vectraits-explorer" class="external-link">VecTraits
Explorer</a> should you so choose.</p>
</div>
<div class="section level2">
<h2 id="getting-data">Getting data<a class="anchor" aria-label="anchor" href="#getting-data"></a>
</h2>
<p>Now you have a vector of datasets, we need to actually retrieve the
data of these datasets through the API.</p>
<p>To do this we can use the <code>get_x_byid()</code> functions. In
this case let’s get the first 5 <em>Aedes aegypti</em> datasets:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aedes_responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vt_byid.html">get_vt_byid</a></span><span class="op">(</span><span class="va">aedes_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">aedes_responses</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;httr2_response&gt;</span></span>
<span><span class="co">## GET https://vectorbyte.crc.nd.edu/portal/api/vectraits-dataset/97/?format=json</span></span>
<span><span class="co">## Status: 200 OK</span></span>
<span><span class="co">## Content-Type: application/json</span></span>
<span><span class="co">## Body: In memory (26362 bytes)</span></span></code></pre>
<p>The <code><a href="../reference/get_vt_byid.html">get_vt_byid()</a></code> function returns a list of the data in
the form of the original <code>httr2</code> responses. These are useful
if you want to know specifics about how the server sent data back, but
for most usecases it is more useful to extract the data into a
dataframe.</p>
</div>
<div class="section level2">
<h2 id="extracting-data">Extracting data<a class="anchor" aria-label="anchor" href="#extracting-data"></a>
</h2>
<p>Now we have a list of responses, we can extract the relevant data
from them using the <code>extract_x_data()</code> functions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aedes_data</span> <span class="op">&lt;-</span> <span class="va">aedes_responses</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/extract_vt_data.html">extract_vt_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Data dimensions: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">aedes_data</span><span class="op">)</span>, <span class="st">" cols x "</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">aedes_data</span><span class="op">)</span>, <span class="st">" rows"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Data dimensions: 157 cols x 21 rows"</span></span></code></pre>
<p>This dataset is a bit too large to print here, and often you may only
want a few columns of data rather than the whole dataset.</p>
<p>Fortunately the <code>cols</code> argument allows us to filter this
data out easily. We can also use the <code>returnunique</code> argument
to instruct ohvbd to return only unique rows.</p>
<p>So let’s get just the unique locations and trait name combinations
from our data using the same command as before:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aedes_data_filtered</span> <span class="op">&lt;-</span> <span class="va">aedes_responses</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/extract_vt_data.html">extract_vt_data</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LocationText"</span>, <span class="st">"OriginalTraitName"</span><span class="op">)</span>,</span>
<span>    returnunique <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">aedes_data_filtered</span></span></code></pre></div>
<pre><code><span><span class="co">##        OriginalTraitName</span></span>
<span><span class="co">## 1              body size</span></span>
<span><span class="co">## 2        blood meal size</span></span>
<span><span class="co">## 3              longevity</span></span>
<span><span class="co">## 4          blood feeding</span></span>
<span><span class="co">## 5 transmission potential</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="chunked-downloading">Chunked downloading<a class="anchor" aria-label="anchor" href="#chunked-downloading"></a>
</h2>
<p>In some cases you may end up downloading a lot of data. This can
cause problems if you do not have enough memory on your computer to
store this data in memory all at once, even if you just want one or two
columns, like before,</p>
<p>One potential method for mitigating this is to use the
<code>get_extract_x_byid_chunked()</code> functions. These only download
a few records at a time and extract them before moving on to the next
chunk of ids. We can perform the filtered extraction from above like
so:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_extract_vt_byid_chunked.html">get_extract_vt_byid_chunked</a></span><span class="op">(</span></span>
<span>  <span class="va">aedes_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>  chunksize <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LocationText"</span>, <span class="st">"OriginalTraitName"</span><span class="op">)</span>,</span>
<span>  returnunique <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        OriginalTraitName</span></span>
<span><span class="co">## 1              body size</span></span>
<span><span class="co">## 2        blood meal size</span></span>
<span><span class="co">## 3              longevity</span></span>
<span><span class="co">## 4          blood feeding</span></span>
<span><span class="co">## 5 transmission potential</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>In day-to-day use, you will mostly find yourself using all these
functions together to create small pipelines.</p>
<p>A typical pipeline would likely only contain a few lines of code:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_vt.html">search_vt</a></span><span class="op">(</span><span class="st">"Aedes aegypti"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/get_vt_byid.html">get_vt_byid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/extract_vt_data.html">extract_vt_data</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Interactor1Genus"</span>, <span class="st">"Interactor1Species"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span><span class="op">)</span>,</span>
<span>    returnunique <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Interactor1Genus Interactor1Species  Latitude Longitude</span></span>
<span><span class="co">## 1            Aedes            aegypti  3.120833 101.65639</span></span>
<span><span class="co">## 2            Aedes            aegypti 16.250000 -61.58333</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="futher-steps">Futher steps<a class="anchor" aria-label="anchor" href="#futher-steps"></a>
</h2>
<p>From here you now have all the data you might need for further
analysis, so now it’s down to you!</p>
<p>One final note to end on: it can be advisable to save any output data
in a csv or parquet format so that you do not need to re-download it
every time you run your script. This is as easy as running
<code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code> on your dataframe, then reading it in later
with <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francis Windram.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
