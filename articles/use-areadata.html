<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sourcing climatic data from AREAdata • ohvbd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sourcing climatic data from AREAdata">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ohvbd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/citations.html">Citing data retrieved using ohvbd</a></li>
    <li><a class="dropdown-item" href="../articles/retrieving-data.html">Retrieving data from VectorByte</a></li>
    <li><a class="dropdown-item" href="../articles/use-areadata.html">Sourcing climatic data from AREAdata</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fwimp/ohvbd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Sourcing climatic data from AREAdata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fwimp/ohvbd/blob/v1.0.0/vignettes/use-areadata.Rmd" class="external-link"><code>vignettes/use-areadata.Rmd</code></a></small>
      <div class="d-none name"><code>use-areadata.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Often when presented with a set of population dynamic data, we may
wish to investigate the abiotic conditions such as temperature or
humidity that these dynamics occurred under.</p>
<p>Ideally this sort of data would have been collected at the same time
as the dynamics data. However with data collected for one project and
then repurposed for another, this is often not possible.</p>
<p>In such scenarios it is possible to link the location of the data
with other measurements of abiotic variables in the area.</p>
<p>These can be retrieved from raster files provided by projects such as
the ERA5 data store from the Copernicus project, however often this is a
large amount of data for a small number of datapoints.</p>
</div>
<div class="section level2">
<h2 id="areadata">AREAdata<a class="anchor" aria-label="anchor" href="#areadata"></a>
</h2>
<p>An alternative method for gathering this data is through the AREAdata
project, which provides historical and forecast data aggregated at
different spatial scales.</p>
<div class="section level3">
<h3 id="setting-up-the-cache">Setting up the cache<a class="anchor" aria-label="anchor" href="#setting-up-the-cache"></a>
</h3>
<p>The downloads for AREAdata are generally quite large, but rarely
updated. As such it’s worthwhile keeping these files around if you’ll
use them regularly.</p>
<p>To do this let’s run a command to set up a local cache.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fwimp/ohvbd" class="external-link">ohvbd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_default_ohvbd_cache.html">set_default_ohvbd_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now you’ve done this, your cached data will not be deleted when you
close R (though you must run this command once per session).</p>
<p>When you run this on your own computer, you will receive a message
giving instructions on how to permanently set this using your <a href="https://docs.posit.co/ide/user/ide/guide/environments/r/managing-r.html#rprofile" class="external-link">.Rprofile</a>
file.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Now you have set up your cache, let’s take a look at the format of
data retrieved from AREAdata (we will deconstruct this command properly
in a bit):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"temp"</span>, gid <span class="op">=</span> <span class="fl">0</span>, use_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Display only a brief summary of the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ad_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2025-12-31 (2192)</span></span>
<span><span class="co">## Locations: 256</span></span></code></pre>
<p>So that is quite a lot of data! Way too much to print here, given
that it’s 561152 entries, however if you want to print all the data
rather than just a summary, you can use the print command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ad_df</span><span class="op">)</span></span></code></pre></div>
<p>AREAdata outputs are formatted as matrices. Here the rows correspond
to locations (identified by GADM codes):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ad_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Aruba"       "Afghanistan" "Angola"      "Anguilla"    "Åland"      </span></span>
<span><span class="co">## [6] "Albania"</span></span></code></pre>
<p>Meanwhile the column names correspond to the day that the data refers
to:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ad_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2020-01-01" "2020-01-02" "2020-01-03" "2020-01-04" "2020-01-05"</span></span>
<span><span class="co">## [6] "2020-01-06"</span></span></code></pre>
<p>So the value at <code>ad_df["Angola", "2020-01-01"]</code>
corresponds to the value of the metric (in this case temperature) in
Angola on 2020-01-01:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span><span class="op">[</span><span class="st">"Angola"</span>, <span class="st">"2020-01-01"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 29.33611</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="deconstructing-fetch_ad">Deconstructing <code>fetch_ad()</code><a class="anchor" aria-label="anchor" href="#deconstructing-fetch_ad"></a>
</h2>
<p>That call above to <code><a href="../reference/fetch_ad.html">fetch_ad()</a></code> used some slightly odd
parameters, so let’s break that down a bit.</p>
<p>The arguments we provided were</p>
<ol style="list-style-type: decimal">
<li>metric = “temp”</li>
<li>gid = 0</li>
<li>use_cache = TRUE</li>
<li>cache_location = cachepath</li>
</ol>
<div class="section level3">
<h3 id="metric">
<code>metric</code><a class="anchor" aria-label="anchor" href="#metric"></a>
</h3>
<p>The metric argument tells <code><a href="../reference/fetch_ad.html">fetch_ad()</a></code> what type of data
it should retrieve from AREAdata.</p>
<p>There are many valid options for this including temperature and
humidity. (See <a href="https://pearselab.github.io/areadata/download-links/" class="external-link">AREAdata</a>
or run <code>?fetch_ad()</code> in the R console for a full list).</p>
</div>
<div class="section level3">
<h3 id="gid">
<code>gid</code><a class="anchor" aria-label="anchor" href="#gid"></a>
</h3>
<p>The gid argument tells <code><a href="../reference/fetch_ad.html">fetch_ad()</a></code> the spatial scale to
download (with higher numbers corresponding to finer scales, at the cost
of larger download sizes).</p>
</div>
<div class="section level3">
<h3 id="use_cache-and-cache_location">
<code>use_cache</code> and <code>cache_location</code><a class="anchor" aria-label="anchor" href="#use_cache-and-cache_location"></a>
</h3>
<p>As the AREAdata files are large and monolithic, it is often
advantageous to download data at an given spatial scale only once.</p>
<p>We can do this by caching the files and retrieving them as needed.
Whilst you could do this manually, <code>ohvbd</code> already has the
functionality to perform this behind the scenes.</p>
<p>If we set <code>use_cache = TRUE</code> then instead of downloading
from the repository immediately, <code>ohvbd</code> will first try to
load any cached version that may be present.</p>
<p>Typically, the cache location is a folder in your user directory,
obtained from <code><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">tools::R_user_dir()</a></code>. However, if you want to
overwrite it (such as if you want to share the cache between different
scripts) you can provide an alternative path to save data to.</p>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>So given the above, let’s construct another function call to download
relative humidity data at the province level (gid 1), caching in the
same folder.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_gid1</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"relhumid"</span>, gid <span class="op">=</span> <span class="fl">1</span>, use_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extracting-specific-data">Extracting specific data<a class="anchor" aria-label="anchor" href="#extracting-specific-data"></a>
</h2>
<p>Extracting data from this matrix can be fiddly, but luckily
<code>ohvbd</code> also provides a function to aid in that:
<code><a href="../reference/glean_ad.html">glean_ad()</a></code>.</p>
<p>So let’s again try to extract the same data as previously, the
temperature in Angola on 2020-01-01:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span>targetdate <span class="op">=</span> <span class="st">"2020-01-01"</span>, places <span class="op">=</span> <span class="st">"Angola"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-01 (1)</span></span>
<span><span class="co">## Locations: 1 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##        2020-01-01</span></span>
<span><span class="co">## Angola   29.33611</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
<p><em>Note: ignore the <code>attr</code> part of the output, this data
just allows <code>ohvbd</code> to ensure consistency between its
functions.</em></p>
<p>Wonderful! But what if we want a range of dates, or many places? What
if the dates fall outside the dates that we have data for, or the places
are not actually present in the data?</p>
<p>This is where <code><a href="../reference/glean_ad.html">glean_ad()</a></code> really shines.</p>
<div class="section level3">
<h3 id="dates-and-date-ranges">Dates and date ranges<a class="anchor" aria-label="anchor" href="#dates-and-date-ranges"></a>
</h3>
<p>Let’s first look at the flexibility of the date arguments to
<code><a href="../reference/glean_ad.html">glean_ad()</a></code>.</p>
<p>If we (for example) want not just one day, we can specify either a
vector of dates, or a less exact date as <code>targetdate</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span></span>
<span>  targetdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-01-01"</span>, <span class="st">"2020-01-02"</span>, <span class="st">"2020-01-05"</span><span class="op">)</span>,</span>
<span>  places <span class="op">=</span> <span class="st">"Angola"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-05 (3)</span></span>
<span><span class="co">## Locations: 1 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##        2020-01-01 2020-01-02 2020-01-05</span></span>
<span><span class="co">## Angola   29.33611   28.77514   28.13407</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span>targetdate <span class="op">=</span> <span class="st">"2020-01"</span>, places <span class="op">=</span> <span class="st">"Angola"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-31 (31)</span></span>
<span><span class="co">## Locations: 1 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##        2020-01-01 2020-01-02 2020-01-03 2020-01-04 2020-01-05 2020-01-06</span></span>
<span><span class="co">## Angola   29.33611   28.77514   28.88312    27.4325   28.13407   28.64046</span></span>
<span><span class="co">##        2020-01-07 2020-01-08 2020-01-09 2020-01-10 2020-01-11 2020-01-12</span></span>
<span><span class="co">## Angola   28.09983   28.40937   28.71222   27.21757   26.85815   28.92744</span></span>
<span><span class="co">##        2020-01-13 2020-01-14 2020-01-15 2020-01-16 2020-01-17 2020-01-18</span></span>
<span><span class="co">## Angola    29.5375   28.88849   28.81174   29.81402   29.89741    29.5939</span></span>
<span><span class="co">##        2020-01-19 2020-01-20 2020-01-21 2020-01-22 2020-01-23 2020-01-24</span></span>
<span><span class="co">## Angola   29.87222   30.28832   30.18386   29.98904   29.97556   29.63855</span></span>
<span><span class="co">##        2020-01-25 2020-01-26 2020-01-27 2020-01-28 2020-01-29 2020-01-30</span></span>
<span><span class="co">## Angola   29.53917   29.00056   28.81855   29.47186   28.44818   28.64745</span></span>
<span><span class="co">##        2020-01-31</span></span>
<span><span class="co">## Angola   28.34594</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 366 days of data return as 2020 is a leap year</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span>targetdate <span class="op">=</span> <span class="st">"2020"</span>, places <span class="op">=</span> <span class="st">"Angola"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 366</span></span></code></pre>
<p>If we would instead like to specify a date range, we can add the
argument <code>enddate</code>.</p>
<p><em>Note: the end date is defined <strong>exclusively</strong>,
meaning that any date before it (and on or after the target date) is
considered to be “in”.</em></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span></span>
<span>  targetdate <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  enddate <span class="op">=</span> <span class="st">"2020-01-04"</span>,</span>
<span>  places <span class="op">=</span> <span class="st">"Angola"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-03 (3)</span></span>
<span><span class="co">## Locations: 1 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##        2020-01-01 2020-01-02 2020-01-03</span></span>
<span><span class="co">## Angola   29.33611   28.77514   28.88312</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="places">Places<a class="anchor" aria-label="anchor" href="#places"></a>
</h3>
<p>Multiple places to extract data for can also be provided as a vector
of places:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span></span>
<span>  targetdate <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  places <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Angola"</span>, <span class="st">"Latvia"</span>, <span class="st">"United Kingdom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-01 (1)</span></span>
<span><span class="co">## Locations: 3 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##                2020-01-01</span></span>
<span><span class="co">## Angola          29.336107</span></span>
<span><span class="co">## Latvia           1.765062</span></span>
<span><span class="co">## United_Kingdom   5.113141</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
<p>This can be combined with the date filters above to create a more
restrictive extraction:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span></span>
<span>  targetdate <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  enddate <span class="op">=</span> <span class="st">"2020-01-04"</span>,</span>
<span>  places <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Angola"</span>, <span class="st">"Latvia"</span>, <span class="st">"United Kingdom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2020-01-01 -&gt; 2020-01-03 (3)</span></span>
<span><span class="co">## Locations: 3 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##                2020-01-01 2020-01-02 2020-01-03</span></span>
<span><span class="co">## Angola          29.336107  28.775145  28.883123</span></span>
<span><span class="co">## Latvia           1.765062   3.268600   2.733880</span></span>
<span><span class="co">## United_Kingdom   5.113141   8.206171   6.198989</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="resiliance">Resiliance<a class="anchor" aria-label="anchor" href="#resiliance"></a>
</h3>
<p>The <code><a href="../reference/glean_ad.html">glean_ad()</a></code> function is also relatively resilient to
the use of dates or places that are not in AREAdata:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ad_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/glean_ad.html">glean_ad</a></span><span class="op">(</span></span>
<span>  targetdate <span class="op">=</span> <span class="st">"2023-12-30"</span>,</span>
<span>  enddate <span class="op">=</span> <span class="st">"2024-01-02"</span>,</span>
<span>  places <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Atlantis"</span>, <span class="st">"Latvia"</span>, <span class="st">"United Kingdom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ohvbd.ad.matrix&gt;</span></span>
<span><span class="co">## Areadata matrix for temp at gid level 0 .</span></span>
<span><span class="co">## Cached: FALSE </span></span>
<span><span class="co">## Dates: 2023-12-30 -&gt; 2024-01-01 (3)</span></span>
<span><span class="co">## Locations: 2 </span></span>
<span><span class="co">## Data:</span></span>
<span><span class="co">##                2023-12-30 2023-12-31 2024-01-01</span></span>
<span><span class="co">## United_Kingdom   7.007509   7.715774   7.124182</span></span>
<span><span class="co">## Latvia           4.098629  -2.789258  -7.665634</span></span>
<span><span class="co">## attr(,"metric")</span></span>
<span><span class="co">## [1] "temp"</span></span>
<span><span class="co">## attr(,"gid")</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## attr(,"cached")</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"db")</span></span>
<span><span class="co">## [1] "ad"</span></span>
<span><span class="co">## attr(,"writetime")</span></span>
<span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "ohvbd.ad.matrix" "matrix"          "array"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="associating-areadata-climatic-variables-with-other-data">Associating AREAdata climatic variables with other data<a class="anchor" aria-label="anchor" href="#associating-areadata-climatic-variables-with-other-data"></a>
</h2>
<p>On top of providing a download interface for AREAdata,
<code>ohvbd</code> provides tools for easing the process of associating
your own data with data from AREAdata.</p>
<p>This is performed through the use of the <code><a href="../reference/assoc_ad.html">assoc_ad()</a></code>
function.</p>
<p>For example, let’s imagine we have some data and their associate
locations:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">lonlatdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UK"</span>, <span class="st">"DE"</span>, <span class="st">"US"</span>, <span class="st">"ES"</span>, <span class="st">"IT"</span>, <span class="st">"BG"</span>, <span class="st">"US"</span><span class="op">)</span>,</span>
<span>    Latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">53.813727033336384</span>, <span class="fl">50.94133730102917</span>, <span class="fl">41.502614374776414</span>, <span class="fl">37.09584576240546</span>,</span>
<span>      <span class="fl">46.190816816324634</span>, <span class="fl">43.40408987260468</span>, <span class="fl">34.02921305111613</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="op">-</span><span class="fl">1.5631510640531983</span>, <span class="fl">6.95792487354786</span>, <span class="op">-</span><span class="fl">73.96228644647785</span>,</span>
<span>      <span class="op">-</span><span class="fl">2.0967211553577694</span>, <span class="fl">11.135228310071971</span>, <span class="fl">28.148385835241964</span>,</span>
<span>      <span class="op">-</span><span class="fl">84.36091597146886</span></span>
<span>    <span class="op">)</span>,</span>
<span>    count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">36</span>, <span class="fl">340</span>, <span class="fl">202</span>, <span class="fl">802</span>, <span class="fl">541</span>, <span class="fl">325</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lonlatdf</span></span></code></pre></div>
<pre><code><span><span class="co">##   Country Latitude  Longitude count</span></span>
<span><span class="co">## 1      UK 53.81373  -1.563151     6</span></span>
<span><span class="co">## 2      DE 50.94134   6.957925    36</span></span>
<span><span class="co">## 3      US 41.50261 -73.962286   340</span></span>
<span><span class="co">## 4      ES 37.09585  -2.096721   202</span></span>
<span><span class="co">## 5      IT 46.19082  11.135228   802</span></span>
<span><span class="co">## 6      BG 43.40409  28.148386   541</span></span>
<span><span class="co">## 7      US 34.02921 -84.360916   325</span></span></code></pre>
<p>If we know that we collected samples between the 4th and 5th of
August 2021, we can associate the temperature values from these regions
on these days at a given spatial scale.</p>
<p>Let’s do this at the country scale:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">areadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span>metric<span class="op">=</span><span class="st">"temp"</span>, gid<span class="op">=</span><span class="fl">0</span>, use_cache<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ad_extract_working</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assoc_ad.html">assoc_ad</a></span><span class="op">(</span><span class="va">lonlatdf</span>, <span class="va">areadata</span>,</span>
<span>                                    targetdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-08-04"</span><span class="op">)</span>, enddate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-08-06"</span><span class="op">)</span>,</span>
<span>                                    gid<span class="op">=</span><span class="fl">0</span>, lonlat_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Suppress lonlat just to make the output easier to read</span></span>
<span><span class="va">ad_extract_working</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Country count temp_2021.08.04 temp_2021.08.05</span></span>
<span><span class="co">## 1      UK     6        15.98993        16.09847</span></span>
<span><span class="co">## 2      DE    36        17.17353        18.25541</span></span>
<span><span class="co">## 3      US   340        26.12418        26.02746</span></span>
<span><span class="co">## 4      ES   202        26.00963        27.42062</span></span>
<span><span class="co">## 5      IT   802        26.21531        24.99068</span></span>
<span><span class="co">## 6      BG   541        29.31433        31.18788</span></span>
<span><span class="co">## 7      US   325        26.12418        26.02746</span></span></code></pre>
<p>If we prefer a finer resolution (e.g. county-level), we could change
the <code>gid</code> argument to a higher number (indicating a finer
scale, up to <code>2</code>):</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">areadata_gid2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span>metric<span class="op">=</span><span class="st">"temp"</span>, gid<span class="op">=</span><span class="fl">2</span>, use_cache<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ad_extract_working_gid2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assoc_ad.html">assoc_ad</a></span><span class="op">(</span><span class="va">lonlatdf</span>, <span class="va">areadata_gid2</span>,</span>
<span>                                    targetdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-08-04"</span><span class="op">)</span>, enddate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-08-06"</span><span class="op">)</span>,</span>
<span>                                    gid<span class="op">=</span><span class="fl">2</span>, lonlat_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ad_extract_working_gid2</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Country count temp_2021.08.04 temp_2021.08.05</span></span>
<span><span class="co">## 1      UK     6        16.35346        16.46636</span></span>
<span><span class="co">## 2      DE    36        16.62339        18.94270</span></span>
<span><span class="co">## 3      US   340        20.59405        20.87954</span></span>
<span><span class="co">## 4      ES   202        29.42114        31.26401</span></span>
<span><span class="co">## 5      IT   802        20.82837        23.16447</span></span>
<span><span class="co">## 6      BG   541        25.01201        25.38486</span></span>
<span><span class="co">## 7      US   325        23.69151        24.70063</span></span></code></pre>
<p>We can see here that by using a finer spatial scale, the two entries
from the US now have different associated temperatures.</p>
</div>
<div class="section level2">
<h2 id="managing-the-areadata-cache">Managing the AREAdata cache<a class="anchor" aria-label="anchor" href="#managing-the-areadata-cache"></a>
</h2>
<p>Interacting with AREAdata requires the caching of a significant
amount of data.</p>
<p>This is generally managed by <code>ohvbd</code> itself, and in most
cases you should not need to worry about it.</p>
<p>However if you want to free up some space, use guaranteed new data,
or see what data <code>ohvbd</code> has currently stored on your
computer, you have a few options available to you.</p>
<div class="section level3">
<h3 id="refresh_cache-for-fetch_ad">
<code>refresh_cache</code> for <code>fetch_ad()</code><a class="anchor" aria-label="anchor" href="#refresh_cache-for-fetch_ad"></a>
</h3>
<p>The <code><a href="../reference/fetch_ad.html">fetch_ad()</a></code> function has an argument called
<code>refresh_cache</code>. If this is set to <code>TRUE</code>, this
will force a refresh of the cache at download time (and suppress loading
from said cache):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span><span class="st">"temp"</span>, gid <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test_ad</span>, <span class="st">"writetime"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2026-02-05 15:31:57 GMT"</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_ad.html">fetch_ad</a></span><span class="op">(</span><span class="st">"temp"</span>, gid <span class="op">=</span> <span class="fl">0</span>, refresh_cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test_ad</span>, <span class="st">"writetime"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2026-02-05 15:32:46 GMT"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="cache-management-tools">Cache management tools<a class="anchor" aria-label="anchor" href="#cache-management-tools"></a>
</h3>
<p>Alternatively you can use the provided tools
<code><a href="../reference/list_ohvbd_cache.html">list_ohvbd_cache()</a></code> and <code><a href="../reference/clean_ohvbd_cache.html">clean_ohvbd_cache()</a></code> to
explore and delete files within the ohvbd cache:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_ohvbd_cache.html">list_ohvbd_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>── Cached files ────────────────────────
Cache location: ../cache/R/ohvbd

── &lt;root&gt;: 0 files ──

none

── adcache: 3 files ──

• relhumid-1.rda
• temp-0.rda
• temp-2.rda

── gadmcache: 6 files ──

• gadm-counties.gpkg
• gadm-countries.gpkg
• gadm-states.gpkg

── vecdyn: 1 file ──

• vd_meta_table.rds</code></pre>
<p>You can filter this by subdirectory, so let’s just look at the data
downloaded from AREAdata (in <code>adcache</code>):</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_ohvbd_cache.html">list_ohvbd_cache</a></span><span class="op">(</span>subdir <span class="op">=</span> <span class="st">"adcache"</span><span class="op">)</span></span></code></pre></div>
<pre><code>── Cached files ────────────────────────
Cache location: ../cache/R/ohvbd

── adcache: 3 files ────────────────────

• relhumid-1.rda
• temp-0.rda
• temp-2.rda</code></pre>
<p>If we wished to delete these files, we could simply run the
following:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_ohvbd_cache.html">clean_ohvbd_cache</a></span><span class="op">(</span>subdir <span class="op">=</span> <span class="st">"adcache"</span><span class="op">)</span></span></code></pre></div>
<pre><code>── Cached files  ────────────────────────
Cache location: ../cache/R/ohvbd

── adcache: 3 files ──

• relhumid-1.rda
• temp-0.rda
• temp-2.rda

! This will permanently delete files from adcache
ℹ Are you sure? [y/N]
&gt;&gt; y

ℹ Clearing files from ../cache/R/ohvbd/adcache
✔ Removed 3 files</code></pre>
<p><span style="opacity: 0.1;font-size: small;">Built in
50.4761159s</span></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francis Windram.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
